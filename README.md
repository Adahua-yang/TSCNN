# Two-Stage Convolutional Neural Network (TSCNN)

This is code for paper: [Person Re-identification Using Two-Stage
Convolutional Neural Network]() by Yonghui Zhang, Jie Shao, Deqiang
Ouyang and Heng Tao Shen (accepted by ICPR 2018).


## Dependency Required

*   Python2.7+

1. Run following code to install tqdm, pandas, numpy, matploblib, cv2

```
$ sudo pip install -U tqdm pandas numpy matploblib opencv-python
```

2. Install pytorch from the source

```
$ git clone --recursive https://github.com/pytorch/pytorch
$ cd pytorch
$ python setup.py install
```

*   matlab

We use `Matlab R2016b` to run the extracting epic flow code. In fact, others version should be fine to run it.


>   Note that we only ran the code in `Unbuntu16-x64`, but it should be able to run successfully in other Linux distribution systems such as `debian` and `centOS`.

## Running

There are two ways to run our codes:

### 1. The simple method to run our code is just runing the bash file `example.sh`, than you can begin training the `iLIDS-VID` dataset and get the result from the command line.

1. change the dirname in `example.sh`

```
# the root dirname of your dataset.
root_path="/home/Documents"

# if you need other dataset, you may need change it according the following tutorials.
download_url="http://www.eecs.qmul.ac.uk/~xiatian/iLIDS-VID/iLIDS-VID.tar"

# the rgb images and the flow images dirname.
# note that the RGB images are download from the url, and the flow images are generated by our 
# epicflow-python3 code.
rgb_root=$root_path"/i-LIDS-VID/sequences"
flow_root=$root_path"/i-LIDS-VID-EpicFlow/sequences"
...
```

2. change the dirname in `base_model/setting.json`

```
# you need change the dirname of them according the dirname in file example.sh.
"i-LIDS-VID_rgb": "/home/yonghui/Documents/i-LIDS-VID/sequences",
"i-LIDS-VID_flow": "/home/yonghui/Documents/i-LIDS-VID-EpicFlow/sequences",

# the file train_ilids.csv and the file valid_ilids.csv are generate by our 
# code. So what you need change is making the exists of the dirnames. for
# example, the dir "/home/yonghui/code/rp_ex/data/" musts existed in my project.
"train_dataset": "/home/yonghui/code/rp_ex/data/train_ilids.csv",
"valid_dataset": "/home/yonghui/code/rp_ex/data/valid_ilids.csv",
```

3. just run `./example.sh`


### 2. For further understanding our method, you may need read our codes in `base_model`, and change the dirname of your own dataset.

you can apply to others dataset by following steps.

1.Download the datasets.

iLIDS-VID:
[http://www.eecs.qmul.ac.uk/~xiatian/downloads_qmul_iLIDS-VID_ReID_dataset.html](http://www.eecs.qmul.ac.uk/~xiatian/downloads_qmul_iLIDS-VID_ReID_dataset.html)

PRID2011:
[https://www.tugraz.at/institute/icg/research/team-bischof/lrs/downloads/PRID11/](https://www.tugraz.at/institute/icg/research/team-bischof/lrs/downloads/PRID11/)

MARS:
[http://www.liangzheng.com.cn/Project/project_mars.html](http://www.liangzheng.com.cn/Project/project_mars.html)

2.Extract epicflow.

Download our another project:
[epicflow-python3](https://github.com/zyoohv/epicflow-python3.git).
More information please see `README.md` file in it.

3.Edit the configure file.

Our setting file `base_model/setting.json` looks like:

```
{
    "generate_dic": {
        ...
        "is_running": true
    },

    "model": {
        ...
        "is_running": false,
        ...
    },

    "full_model": {
        ...
        "is_running": false,
        ...
    }
}
```

in which the key word `is_running` decides to run this part code or
not. The default setting is used to do experiment in `iLIDS-VID`
dataset. Edit it if needed in other datasets.

### 4.Run `base_model/run.sh`.

## QA

Any question will be replied in `Issues`, or email the author:
`zyoohv@gmail.com`
